<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>关于Logstash中grok插件的正则表达式例子 | chris&#39;wang</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://chriswsq.github.io/favicon.ico?v=1612689859244">
<link rel="stylesheet" href="https://chriswsq.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="日志收集里最重要的就是logstash对日志的过滤，Logstash里提供了一系列的filter来让我们转换日志。Grok就是这些filters里最重要的一个插件，下面就了解下

Grok提供的常用Patterns说明及举例
大多数Linu..." />
    <meta name="keywords" content="ELK" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://chriswsq.github.io">
        <img src="https://chriswsq.github.io/images/avatar.png?v=1612689859244" class="site-logo">
        <h1 class="site-title">chris&#39;wang</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      当你觉得无所事事时，那你就是在虚度光阴
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://chriswsq.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">关于Logstash中grok插件的正则表达式例子</h2>
            <div class="post-date">2020-08-27</div>
            
            <div class="post-content" v-pre>
              <p>日志收集里最重要的就是logstash对日志的过滤，Logstash里提供了一系列的filter来让我们转换日志。Grok就是这些filters里最重要的一个插件，下面就了解下</p>
<!-- more -->
<h2 id="grok提供的常用patterns说明及举例">Grok提供的常用Patterns说明及举例</h2>
<p>大多数Linux使用人员都有过用正则表达式来查询机器中相关文件或文件里内容的经历，在Grok里，我们也是使用正则表达式来识别日志里的相关数据块。</p>
<p>有两种方式来使用正则表达式：</p>
<p>直接写正则来匹配<br>
用Grok表达式映射正则来匹配</p>
<h3 id="常用表达式">常用表达式</h3>
<ul>
<li>
<p>GREEDYDATA<br>
<strong>匹配任意字符</strong></p>
</li>
<li>
<p>USERNAME 或 USER<br>
<strong>用户名</strong>，由数字、大小写及特殊字符(._-)组成的字符串</p>
</li>
</ul>
<blockquote>
<p>比如：1234、Bob、Alex.Wong等</p>
</blockquote>
<ul>
<li>EMAILLOCALPART<br>
<strong>电子邮件用户名部分</strong>，首位由大小写字母组成，其他位由数字、大小写及特殊字符(_.+-=:)组成的字符串。注意，国内的QQ纯数字邮箱账号是无法匹配的，需要修改正则</li>
</ul>
<blockquote>
<p>比如：stone、Gary_Lu、abc-123等</p>
</blockquote>
<ul>
<li>EMAILADDRESS<br>
<strong>电子邮件</strong></li>
</ul>
<blockquote>
<p>比如：wwwwaf@abc.com、Gadf_adf@gmail.com、abc-123@163.com等</p>
</blockquote>
<ul>
<li>
<p>HTTPDUSER<br>
Apache服务器的用户，可以是EMAILADDRESS或USERNAME</p>
</li>
<li>
<p>INT<br>
<strong>整数，包括0和正负整数</strong></p>
</li>
</ul>
<blockquote>
<p>比如：0、-123、43987等</p>
</blockquote>
<ul>
<li>BASE10NUM 或 NUMBER<br>
<strong>十进制数字，包括整数和小数</strong></li>
</ul>
<blockquote>
<p>比如：0、18、5.23等</p>
</blockquote>
<ul>
<li>BASE16NUM<br>
<strong>十六进制数字，整数</strong></li>
</ul>
<blockquote>
<p>比如：0x0045fa2d、-0x3F8709等</p>
</blockquote>
<ul>
<li>WORD<br>
<strong>字符串，包括数字和大小写字母</strong></li>
</ul>
<blockquote>
<p>比如：String、3529345、ILoveYou等</p>
</blockquote>
<ul>
<li>
<p>NOTSPACE<br>
<strong>不带任何空格的字符串</strong></p>
</li>
<li>
<p>SPACE<br>
<strong>空格字符串</strong></p>
</li>
<li>
<p>{SPACE}*<br>
**匹配任意连续空格</p>
</li>
<li>
<p>QUOTEDSTRING 或 QS<br>
带引号的字符串</p>
</li>
</ul>
<blockquote>
<p>比如：&quot;This is an apple&quot;、'What is your name?'等</p>
</blockquote>
<ul>
<li>UUID<br>
<strong>标准UUID</strong></li>
</ul>
<blockquote>
<p>比如：550E8400-E29B-11D4-A716-446655440000</p>
</blockquote>
<ul>
<li>
<p>MAC<br>
<strong>MAC地址</strong>，可以是Cisco设备里的MAC地址，也可以是通用或者Windows系统的MAC地址</p>
</li>
<li>
<p>IP<br>
<strong>IP地址</strong>，IPv4或IPv6地址</p>
</li>
</ul>
<blockquote>
<p>比如：127.0.0.1、FE80:0000:0000:0000:AAAA:0000:00C2:0002等</p>
</blockquote>
<ul>
<li>
<p>HOSTNAME<br>
<strong>主机名称</strong></p>
</li>
<li>
<p>IPORHOST<br>
<strong>IP或者主机名称</strong></p>
</li>
<li>
<p>HOSTPORT<br>
<strong>主机名(IP)+端口</strong></p>
</li>
</ul>
<blockquote>
<p>比如：127.0.0.1:3306、api.stozen.net:8000等</p>
</blockquote>
<ul>
<li>PATH<br>
<strong>路径</strong>，Unix系统或者Windows系统里的路径格式</li>
</ul>
<blockquote>
<p>比如：/usr/local/nginx/sbin/nginx、c:\windows\system32\clr.exe等</p>
</blockquote>
<ul>
<li>URIPROTO<br>
<strong>URI协议</strong></li>
</ul>
<blockquote>
<p>比如：http、ftp等</p>
</blockquote>
<ul>
<li>URIHOST<br>
<strong>URI主机</strong></li>
</ul>
<blockquote>
<p>比如：www.baidu.net、10.0.0.1:22等</p>
</blockquote>
<ul>
<li>URIPATH<br>
<strong>URI路径</strong></li>
</ul>
<blockquote>
<p>比如：<code>//www.baidu.net/abc/、/api.php</code>等</p>
</blockquote>
<ul>
<li>URIPARAM<br>
<strong>URI里的GET参数</strong></li>
</ul>
<blockquote>
<p>比如：?a=1&amp;b=2&amp;c=3</p>
</blockquote>
<ul>
<li>URIPATHPARAM<br>
<strong>URI路径+GET参数</strong></li>
</ul>
<blockquote>
<p>比如：<code>//www.google.net/abc/api.php?a=1&amp;b=2&amp;c=3</code></p>
</blockquote>
<ul>
<li>URI<br>
<strong>完整的URI</strong></li>
</ul>
<blockquote>
<p>比如：<code>http://www.google.net/abc/api.php?a=1&amp;b=2&amp;c=3</code></p>
</blockquote>
<h3 id="日期时间表达式">日期时间表达式</h3>
<ul>
<li>MONTH<br>
<strong>月份名称</strong></li>
</ul>
<blockquote>
<p>比如：Jan、January等</p>
</blockquote>
<ul>
<li>MONTHNUM<br>
<strong>月份数字</strong></li>
</ul>
<blockquote>
<p>比如：03、9、12等</p>
</blockquote>
<ul>
<li>MONTHDAY<br>
<strong>日期数字</strong></li>
</ul>
<blockquote>
<p>比如：03、9、31等</p>
</blockquote>
<ul>
<li>DAY<br>
<strong>星期几名称</strong></li>
</ul>
<blockquote>
<p>比如：Mon、Monday等</p>
</blockquote>
<ul>
<li>YEAR<br>
<strong>年份数字</strong></li>
<li>HOUR<br>
<strong>小时数字</strong></li>
<li>MINUTE<br>
<strong>分钟数字</strong></li>
<li>SECOND<br>
<strong>秒数字</strong></li>
<li>TIME<br>
<strong>时间</strong></li>
</ul>
<blockquote>
<p>比如：00:01:23</p>
</blockquote>
<ul>
<li>DATE_US<br>
<strong>美国日期格式</strong></li>
</ul>
<blockquote>
<p>比如：10-15-1982、10/15/1982等</p>
</blockquote>
<ul>
<li>DATE_EU<br>
<strong>欧洲日期格式</strong></li>
</ul>
<blockquote>
<p>比如：15-10-1982、15/10/1982、15.10.1982等</p>
</blockquote>
<ul>
<li>ISO8601_TIMEZONE<br>
<strong>ISO8601时间格式</strong></li>
</ul>
<blockquote>
<p>比如：+10:23、-1023等</p>
</blockquote>
<ul>
<li>TIMESTAMP_ISO8601<br>
<strong>ISO8601时间戳格式</strong></li>
</ul>
<blockquote>
<p>比如：2016-07-03T00:34:06+08:00</p>
</blockquote>
<ul>
<li>
<p>DATE<br>
<strong>日期</strong>，美国日期%{DATE_US}或者欧洲日期%{DATE_EU}</p>
</li>
<li>
<p>DATESTAMP<br>
<strong>完整日期+时间</strong></p>
</li>
</ul>
<blockquote>
<p>比如：07-03-2016 00:34:06</p>
</blockquote>
<ul>
<li>HTTPDATE<br>
<strong>http默认日期格式</strong></li>
</ul>
<blockquote>
<p>比如：03/Jul/2016:00:36:53 +0800</p>
</blockquote>
<h3 id="log表达式">Log表达式</h3>
<ul>
<li>LOGLEVEL<br>
<strong>日志等级</strong></li>
</ul>
<blockquote>
<p>比如：Alert、alert、ALERT、Error等</p>
</blockquote>
<h2 id="创建自己的grok表达式">创建自己的Grok表达式</h2>
<p>在业务领域中，可能会有越来越多的日志格式出现在我们眼前，而Grok的默认表达式显然已无法满足我们的需求（比如用户身份证号、手机号等信息），所以，我们需要自己动手添加些表达式。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>正则表达式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE_CHS</td>
<td>%{YEAR}[./-]%{MONTHNUM}[./-]%{MONTHDAY}</td>
<td>中国人习惯的日期格式</td>
</tr>
<tr>
<td>ZIPCODE_CHS</td>
<td>[1-9]\d{5}</td>
<td>国内邮政编码</td>
</tr>
<tr>
<td>GAME_ACCOUNT</td>
<td>[a-zA-Z][a-zA-Z0-9_]{4,15}</td>
<td>游戏账号，首字符为字母，4-15位字母、数字、下划线组成</td>
</tr>
</tbody>
</table>
<h2 id="其他">其他</h2>
<p>grok正则表达式：(?<temMsg>(.<em>)(?=Report)/?) 获取Report之前的字符<br>
grok正则表达式：(?<temMsg>(?=Report)(.</em>)/?) 获取Report之后的字符</p>
<p><a href="https://www.cnblogs.com/stozen/p/5638369.html">参考</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://chriswsq.github.io/tag/Nqh1b7Zat/" class="tag">
                    ELK
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://chriswsq.github.io/post/sheng-chan-huan-jing-bu-shu-fabric/">
                  <h3 class="post-title">
                    生产环境部署fabric
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>





  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: '',
        owner: '',
        admin: [''],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
