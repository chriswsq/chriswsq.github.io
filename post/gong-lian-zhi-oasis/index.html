<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>公链之oasis | chris&#39;wang</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://chriswsq.github.io/favicon.ico?v=1614238271815">
<link rel="stylesheet" href="https://chriswsq.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="Oasis部署文档
节点选择
Oasis服务节点分为： 验证节点、非验证节点、种子节点
根据我们的需求部署了非验证节点
非验证节点开放rpc接口需要通过网关代理，这里选择的是rosetta
部署方式
测试网


IP : 18.163.23..." />
    <meta name="keywords" content="公链" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://chriswsq.github.io">
        <img src="https://chriswsq.github.io/images/avatar.png?v=1614238271815" class="site-logo">
        <h1 class="site-title">chris&#39;wang</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      当你觉得无所事事时，那你就是在虚度光阴
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://chriswsq.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">公链之oasis</h2>
            <div class="post-date">2020-11-03</div>
            
            <div class="post-content" v-pre>
              <h1 id="oasis部署文档">Oasis部署文档</h1>
<h2 id="节点选择">节点选择</h2>
<p>Oasis服务节点分为： 验证节点、非验证节点、种子节点</p>
<p>根据我们的需求部署了非验证节点</p>
<p>非验证节点开放rpc接口需要通过网关代理，这里选择的是rosetta</p>
<h2 id="部署方式">部署方式</h2>
<h3 id="测试网">测试网</h3>
<ul>
<li>
<p>IP : 18.163.236.xxx</p>
</li>
<li>
<p>server port: 8080</p>
</li>
<li>
<p>Oasis 版本为: 20.12.1</p>
</li>
<li>
<p>Resetta 版本为: master</p>
</li>
</ul>
<p>**下载resetta **</p>
<pre><code class="language-bash">git  clone https://github.com/oasisprotocol/oasis-core-rosetta-gateway.git
</code></pre>
<p><strong>打包镜像</strong></p>
<pre><code class="language-bash">cd  oasis-core-rosetta-gateway/docker

docker build -t oasis:20.12.1 .
</code></pre>
<p><strong>config.yml文件：</strong></p>
<pre><code class="language-yml">datadir: /data

log:
  level:
    default: info
    tendermint: info
    tendermint/context: error
  format: JSON

genesis:
  file: /node/etc/genesis.json

consensus:
  tendermint:
    core:
      listen_address: tcp://0.0.0.0:8545
    p2p:
      # List of seed nodes to connect to.
      # NOTE: You can add additional seed nodes to this list if you want.
      seed:
        - &quot;05EAC99BB37F6DAAD4B13386FF5E087ACBDDC450@34.86.165.6:26656&quot;
</code></pre>
<p><strong>genesis.json 文件使用：</strong></p>
<p>https://github.com/oasisprotocol/public-testnet-artifacts/releases/download/2020-09-15/genesis.json</p>
<p><strong>docker-compose.yml</strong></p>
<pre><code class="language-yml">version: '2'
services:
  oasis: 
    image: oasis:20.12.1
    container_name: oasis
    volumes:
      - /bsn/oasis/node/data/:/data
      - /bsn/oasis/node/etc:/node/etc
    environment:
      - OASIS_ROSETTA_GATEWAY_PORT=8080
    ports:
      - 8080:8080
    restart: always

</code></pre>
<p><strong>启动</strong></p>
<p>测试网同时启动节点和resetta会报错：</p>
<pre><code class="language-bash">{“caller”:“grpc.go:202”,“err”:“failed to get consensus status: failed to load validator set: could not find validator set for height #1”,“level”:“error”,“method”:“/oasis-core.NodeController/GetStatus”,“module”:“grpc/internal”,“msg”:“request failed”,“req_seq”:117,“ts”:“2020-11-04T13:52:24.340094029Z”}
</code></pre>
<p>所以需要启动节点一段时间后启动rosetta ，使用<code>docker-compose up -d</code> 后进入容器执行</p>
<p><code>nohup oasis-core-rosetta-gateway &gt;/dev/null 2&gt;&amp;1 &amp;</code></p>
<h3 id="主网">主网</h3>
<ul>
<li>
<p>IP : 18.163.224.xxx</p>
</li>
<li>
<p>server port: 8080</p>
</li>
<li>
<p>修改oasis版本为：20.11.3</p>
</li>
<li>
<p>Resetta 版本为: master</p>
</li>
</ul>
<p>**下载resetta **</p>
<pre><code class="language-bash">git  clone https://github.com/oasisprotocol/oasis-core-rosetta-gateway.git
</code></pre>
<p><strong>打包镜像</strong></p>
<pre><code class="language-bash">cd  oasis-core-rosetta-gateway/docker

docker build -t oasis:20.11.3 .
</code></pre>
<p><strong>config.yml文件：</strong></p>
<pre><code class="language-yml">datadir: /data

log:
 level:
   default: info
   tendermint: info
   tendermint/context: error
 format: JSON

genesis:
 file: /node/etc/genesis.json

consensus:
 tendermint:
   p2p:
     # List of seed nodes to connect to.
     # NOTE: You can add additional seed nodes to this list if you want.
     seed:
       - &quot;E27F6B7A350B4CC2B48A6CBE94B0A02B0DCB0BF3@35.199.49.168:26656&quot;


</code></pre>
<p><strong>genesis.json 文件使用：</strong></p>
<p>https://github.com/oasisprotocol/mainnet-artifacts/releases/download/2020-10-01/genesis.json</p>
<p><strong>docker-compose.yml</strong></p>
<pre><code class="language-yml">version: '2'
services:
  oasis: 
    image: oasis:20.11.3
    container_name: oasis
    volumes:
      - /bsn/oasis/node/data/:/data
      - /bsn/oasis/node/etc:/node/etc
    environment:
      - OASIS_ROSETTA_GATEWAY_PORT=8080
    ports:
      - 8080:8080
    restart: always
</code></pre>
<p><strong>启动</strong></p>
<pre><code class="language-bash">docker-compose up -d
</code></pre>
<h2 id="检测">检测</h2>
<p>curl  -H &quot;Content-Type:application/json&quot;  -X POST --data '{&quot;metadata&quot;:{}}' http://127.0.0.1:8080/network/list</p>
<h2 id="相关地址">相关地址</h2>
<p><strong>Oasis Gateway for Rosetta:</strong></p>
<ul>
<li>https://github.com/oasisprotocol/oasis-core-rosetta-gateway</li>
</ul>
<p><strong>mainnet  Oasis seed node address:</strong></p>
<ul>
<li>https://docs.oasis.dev/general/oasis-network/network-parameters</li>
</ul>
<p><strong>testnet  Oasis seed node address:</strong></p>
<ul>
<li>https://docs.oasis.dev/general/oasis-foundation-testnet/testnet</li>
</ul>
<p><strong>rosetta-api docs:</strong></p>
<p>https://www.rosetta-api.org/docs/welcome.html</p>
<p>参考<br>
https://docs.oasis.dev/general/run-a-node/set-up-your-node/run-non-validator<br>
https://docs.oasis.dev/oasis-core/high-level-components/oasis-node/rpc<br>
https://docs.oasis.dev/general/oasis-network/network-parameters<br>
https://github.com/oasisprotocol/oasis-core/releases/tag/v20.10<br>
https://github.com/oasisprotocol/oasis-core-rosetta-gateway</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://chriswsq.github.io/tag/0OaJlvEHw/" class="tag">
                    公链
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://chriswsq.github.io/post/redis/">
                  <h3 class="post-title">
                    redis
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
