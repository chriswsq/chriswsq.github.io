<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://chriswsq.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="å½“ä½ è§‰å¾—æ— æ‰€äº‹äº‹æ—¶ï¼Œé‚£ä½ å°±æ˜¯åœ¨è™šåº¦å…‰é˜´"><meta charset="UTF-8"><title>Kubernetes åŸºç¡€æ•™å­¦ï¼ˆäºŒï¼‰å®ä½œèŒƒä¾‹ï¼šPodã€Serviceã€Deploymentã€Ingress | chris&#39;wang</title>
<link href="https://chriswsq.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://chriswsq.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://chriswsq.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<link rel="canonical" href="https://chriswsq.github.io/post/kubernetes-ji-chu-jiao-xue-er-shi-zuo-fan-li-podservicedeploymentingress/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://chriswsq.github.io"><img alt="logo" style="display:inline-block;" src="https://chriswsq.github.io/images/avatar.png"/></a><h1 title="chris&#39;wang" class="weaklink"><a  href="/">chris&#39;wang</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1602556680965" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>Kubernetes åŸºç¡€æ•™å­¦ï¼ˆäºŒï¼‰å®ä½œèŒƒä¾‹ï¼šPodã€Serviceã€Deploymentã€Ingress</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-08-20</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://chriswsq.github.io/tag/09VioQtSo/" class="tag">kubernetes</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">3674å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">16 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<p>Kubernetesï¼ˆK8Sï¼‰æ˜¯ä¸€å€‹å¯ä»¥å¹«åŠ©æˆ‘å€‘ç®¡ç†å¾®æœå‹™ï¼ˆmicroservicesï¼‰çš„ç³»çµ±ï¼Œä»–å¯ä»¥è‡ªå‹•åŒ–åœ°éƒ¨ç½²åŠç®¡ç†å¤šå°æ©Ÿå™¨ä¸Šçš„å¤šå€‹å®¹å™¨ï¼ˆContainerï¼‰ã€‚ç°¡å–®ä¾†èªªï¼Œä»–å¯ä»¥åšåˆ°ï¼š</p>
<!-- more -->
<p>Kubernetesï¼ˆK8Sï¼‰æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†å¾®æœåŠ¡ï¼ˆmicroservicesï¼‰çš„ç³»ç»Ÿï¼Œä»–å¯ä»¥è‡ªåŠ¨åŒ–åœ°éƒ¨ç½²åŠç®¡ç†å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªå®¹å™¨ï¼ˆContainerï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œä»–å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li>åŒæ—¶éƒ¨ç½²å¤šä¸ªå®¹å™¨åˆ°å¤šå°æœºå™¨ä¸Šï¼ˆDeploymentï¼‰</li>
<li>æœåŠ¡çš„ä¹˜è½½é‡æœ‰å˜åŒ–æ—¶ï¼Œå¯ä»¥å¯¹å®¹å™¨åšè‡ªåŠ¨æ‰©å±•ï¼ˆScalingï¼‰</li>
<li>ç®¡ç†å¤šä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œè‡ªåŠ¨ä¾¦æµ‹å¹¶é‡å¯æ•…éšœçš„å®¹å™¨ï¼ˆManagementï¼‰</li>
</ul>
<p>åœ¨ç³»åˆ—æ–‡çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†æ„æˆ Kubernetes çš„å››ä¸ªé‡è¦å…ƒç´ ï¼šPodã€Nodeã€Masterã€Clusterï¼Œå¹¶å®‰è£…å¥½äº†æˆ‘ä»¬è¦å®é™…åŠ¨æ‰‹ç© Kubernetes å‰éœ€è¦çš„å¥—ä»¶ä¸å·¥å…·ã€‚æ¥ä¸‹æ¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šé€è¿‡ä¾‹å­æ¥å®é™…å»ºç«‹é‚£äº›åœ¨ Kubernetes ä¸­å¸¸è§çš„å…ƒä»¶ä»¬ã€‚</p>
<h2 id="å¦‚ä½•å»ºç«‹ä¸€ä¸ª-pod">å¦‚ä½•å»ºç«‹ä¸€ä¸ª Pod</h2>
<h2 id="æ’°å†™-pod-çš„èº«åˆ†è¯">æ’°å†™ Pod çš„èº«åˆ†è¯</h2>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä»‹ç» Kubernetes æ—¶æœ‰æåˆ°ï¼Œæ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªèº«åˆ†è¯ï¼Œä¹Ÿå°±æ˜¯å±äºè¿™ä¸ª Pod çš„ .yaml æ¡£ã€‚æˆ‘ä»¬é€è¿‡æ’°å†™ä¸‹é¢çš„è¿™ä¸ª .yaml æ¡£å°±å¯ä»¥å»ºç«‹å‡º Podã€‚</p>
<p>kubernetes-demo.yaml</p>
<pre><code class="language-yaml">apiVersion: v1
 kind: Pod
 metadata:
   name: kubernetes-demo-pod
   labels:
     app: demoApp
 spec:
   containers:
     - name: kubernetes-demo-container
       image: hcwxd/kubernetes-demo
       ports:
         - containerPort: 3000
</code></pre>
<p>apiVersion</p>
<ul>
<li>è¯¥å…ƒä»¶ç‰ˆæœ¬å·</li>
</ul>
<p>kind</p>
<ul>
<li>è¯¥å…ƒä»¶æ˜¯ä»€ä¹ˆå±æ€§ï¼Œå¸¸è§æœ‰ Podã€Nodeã€Serviceã€Namespaceã€ReplicationController ç­‰</li>
</ul>
<p>metadata</p>
<p>name</p>
<ul>
<li>æŒ‡å®šè¯¥ Pod çš„åç§°<br>
labels</li>
<li>æŒ‡å®šè¯¥ Pod çš„æ ‡ç­¾ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚æ—¶å¸®å®ƒä¸Šæ ‡ç­¾ä¸º app: demoApp</li>
</ul>
<p>spec</p>
<p>container.name</p>
<ul>
<li>æŒ‡å®šè¿è¡Œå‡ºçš„ Container çš„åç§°</li>
</ul>
<p>container.image</p>
<ul>
<li>æŒ‡å®š Container è¦ä½¿ç”¨å“ªä¸ª Imageï¼Œè¿™é‡Œä¼šä» DockerHub ä¸Šæœå¯»</li>
</ul>
<p>container.ports</p>
<ul>
<li>æŒ‡å®šè¯¥ Container æœ‰å“ªäº› port number æ˜¯å…è®¸å¤–éƒ¨èµ„æºå­˜å–</li>
</ul>
<h2 id="é€è¿‡-kubectl-å»ºç«‹-pod">é€è¿‡ kubectl å»ºç«‹ Pod</h2>
<p>æœ‰äº†èº«ä»½è¯åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€è¿‡ kubectl æŒ‡ä»¤æ¥å»ºç«‹ Pod</p>
<p><code>kubectl create -f kubernetes-demo.yaml</code></p>
<p>çœ‹åˆ° <code>pod/kubernetes-demo-pod created</code> çš„å­—æ ·å°±ä»£è¡¨æˆ‘ä»¬å»ºç«‹æˆåŠŸæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Pod äº†ã€‚æˆ‘ä»¬å¯ä»¥å†é€è¿‡æŒ‡ä»¤</p>
<p><code>kubectl get pods</code></p>
<p>çœ‹åˆ°æˆ‘ä»¬è¿è¡Œä¸­çš„ Podï¼š</p>
<pre><code class="language-bash">NAME                  READY   STATUS    RESTARTS   AGE
kubernetes-demo-pod   1/1     Running   0          60s
</code></pre>
<h2 id="è¿çº¿åˆ°æˆ‘ä»¬-pod-çš„æœåŠ¡èµ„æº">è¿çº¿åˆ°æˆ‘ä»¬ Pod çš„æœåŠ¡èµ„æº</h2>
<p>å»ºç«‹å¥½æˆ‘ä»¬çš„ Pod ä¹‹åï¼Œæ‰“å¼€æµè§ˆå™¨çš„ <code>localhost:3000</code> æˆ‘ä»¬ä¼šå‘ç°æ€ä¹ˆä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Pod ä¸­æ‰€æŒ‡å®šçš„ portï¼Œè·Ÿæˆ‘ä»¬æœ¬æœºç«¯çš„ port æ˜¯ä¸ç›¸é€šçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è¿˜è¦é€è¿‡ <code>kubectl port-forward</code>ï¼ŒæŠŠæˆ‘ä»¬ä¸¤ç«¯çš„ port åš mappingã€‚</p>
<p><code>kubectl port-forward kubernetes-demo-pod 3000:3000</code></p>
<p>åšå¥½ mapping åï¼Œå†æ‰“å¼€æµè§ˆå™¨çš„ localhost:3000 ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿æ¥ä¸€åªå¯çˆ±çš„å°é²¸é±¼å•°ï¼</p>
<figure data-type="image" tabindex="1"><img src="https://chriswsq.github.io/post-images/1597918423758.png" alt="" loading="lazy"></figure>
<h2 id="kubernetes-è¿›é˜¶ä¸‰å…ƒä»¶">Kubernetes è¿›é˜¶ä¸‰å…ƒä»¶</h2>
<p>äº†è§£å®Œå¦‚ä½•ä»æ— åˆ°æœ‰å»ºç«‹ä¸€ä¸ª Kubernetes Cluster å¹¶äº§ç”Ÿä¸€ä¸ª Pod åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦è®¤è¯†åœ¨ç°å®åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šæ­é…åˆ°å“ªäº› Kubernetes çš„è¿›é˜¶å…ƒä»¶ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸‰ä¸ªè¿›é˜¶å…ƒä»¶å°±æ˜¯ï¼šServiceã€Ingressã€Deploymentã€‚</p>
<p><strong>Service</strong></p>
<p>è¿˜è®°å¾—ä¸Šé¢æåˆ°æˆ‘ä»¬åœ¨è¿çº¿åˆ°ä¸€ä¸ª Pod çš„æœåŠ¡èµ„æºæ—¶ï¼Œä¼šä½¿ç”¨åˆ° port-forward çš„æŒ‡ä»¤ã€‚ä½†å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª Pods æƒ³è¦åŒæ—¶è¢«è¿çº¿æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ° Service è¿™ä¸ªè¿›é˜¶å…ƒä»¶ã€‚ç®€å•æ¥è¯´ï¼ŒService å°±æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ã€Œä¸€ç¾¤ Pod è¦å¦‚ä½•è¢«è¿çº¿åŠå­˜å–ã€çš„å…ƒä»¶ã€‚</p>
<p>è¦å»ºç«‹ä¸€ä¸ª Serviceï¼Œä¸€æ ·è¦æ’°å†™å±äºä»–çš„èº«åˆ†è¯ã€‚</p>
<p>service.yaml</p>
<pre><code class="language-yaml">apiVersion: v1
 kind: Service
 metadata:
   name: my-service
 spec:
   selector:
     app: demoApp
   type: NodePort
   ports:
     - protocol: TCP
       port: 3001
       targetPort: 3000
       nodePort: 30390
</code></pre>
<p>apiVersion</p>
<ul>
<li>è¯¥å…ƒä»¶çš„ç‰ˆæœ¬å·</li>
</ul>
<p>kind</p>
<ul>
<li>è¯¥å…ƒä»¶æ˜¯ä»€ä¹ˆå±æ€§ï¼Œå¸¸è§æœ‰ Podã€Nodeã€Serviceã€Namespaceã€ReplicationController ç­‰</li>
</ul>
<p>metadata</p>
<ul>
<li>name<br>
æŒ‡å®šè¯¥ Pod çš„åç§°</li>
</ul>
<p>spec</p>
<ul>
<li>
<p>selector<br>
è¯¥ Service çš„è¿çº¿è§„åˆ™é€‚ç”¨åœ¨å“ªä¸€ç¾¤ Podsï¼Œè¿˜è®°å¾—æˆ‘ä»¬åœ¨å»ºç«‹ Pod çš„æ—¶å€™ï¼Œä¼šå¸®å®ƒä¸Š labelï¼Œè¿™æ—¶å°±å¯ä»¥é€è¿‡ app: demoAppï¼Œå»æ‰¾åˆ°é‚£ç¾¤ label çš„ app å±æ€§æ˜¯ demoApp çš„ Pods ä»¬</p>
</li>
<li>
<p>ports</p>
<ul>
<li>targetPort<br>
æŒ‡å®šæˆ‘ä»¬ Pod ä¸Šå…è®¸å¤–éƒ¨èµ„æºå­˜å– Port Number</li>
<li>port<br>
æŒ‡å®šæˆ‘ä»¬ Pod ä¸Šçš„ targetPort è¦ mapping åˆ° Service ä¸­ ClusterIP ä¸­çš„å“ªä¸ª port</li>
<li>nodePort<br>
æŒ‡å®šæˆ‘ä»¬ Pod ä¸Šçš„ targetPort è¦ mapping åˆ° Node ä¸Šçš„å“ªä¸ª port</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆé‡æ–°å»ºç«‹æˆ‘ä»¬çš„ Pod</p>
<p><code>kubectl create -f kubernetes-demo.yaml</code></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€è¿‡ service.yaml æ¥å»ºç«‹æˆ‘ä»¬çš„ Service å…ƒä»¶</p>
<p><code>kubectl create -f service.yaml</code></p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥é€è¿‡</p>
<p><code>kubectl get services</code></p>
<p>å–å¾—æˆ‘ä»¬æ–°å»ºç«‹ Service çš„èµ„æ–™</p>
<pre><code class="language-bash">NAME       TYPE      CLUSTER-IP     EXTERNAL-IP PORT(S)          AGE
my-service NodePort  10.110.237.205 &lt;none&gt;      3001:30391/TCP   60s
</code></pre>
<p>æœ‰äº†å»ºç«‹å¥½çš„ Service åï¼Œæˆ‘ä»¬å¯ä»¥é€è¿‡ä¸¤ç§æ–¹å¼è¿çº¿æˆ‘ä»¬çš„ Pod çš„æœåŠ¡èµ„æºã€‚é¦–å…ˆï¼Œè¦ä»å¤–éƒ¨è¿çº¿åˆ°æˆ‘ä»¬çš„ Pod èµ„æºæœåŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆæœ‰æˆ‘ä»¬çš„ Kubernetes Clusterï¼ˆåœ¨è¿™è¾¹æ˜¯ minikubeï¼‰å¯¹å¤–å¼€æ”¾çš„ IPã€‚æˆ‘ä»¬å…ˆé€è¿‡æŒ‡ä»¤</p>
<p><code>minikube ip</code></p>
<p>å¾—åˆ°æˆ‘ä»¬ minikube çš„ ip</p>
<p><code>192.168.99.100</code></p>
<p>æ¥ç€æ‰“å¼€æˆ‘ä»¬çš„æµè§ˆå™¨ï¼Œè¾“å…¥ä¸Šé¢çš„ ip åŠ ä¸Šæˆ‘ä»¬åœ¨ yaml æ¡£æŒ‡å®šçš„ nodePortï¼Œåœ¨è¿™è¾¹æ˜¯ 192.168.99.100:30390ï¼Œå°±ä¼šå¾—åˆ°æˆ‘ä»¬çš„å°é²¸é±¼äº†ã€‚</p>
<p>è€Œå¦‚æœä¸ä»æµè§ˆå™¨ï¼Œè€Œæ˜¯ç›´æ¥ä» minikube é‡Œé¢è¿çº¿åˆ°æˆ‘ä»¬çš„ Pod åˆ™è¦å…ˆé€è¿‡æŒ‡ä»¤</p>
<p><code>minikube ssh</code></p>
<p>ssh è¿›å…¥æˆ‘ä»¬çš„ minikube clusterï¼Œæ¥ç€è¾“å…¥æŒ‡ä»¤</p>
<p><code>curl &lt;CLUSTER-IP&gt;:&lt;port&gt;</code></p>
<p>å…¶ä¸­ CLUSTER-IP å°±æ˜¯æˆ‘ä»¬ç”¨ kubectl get services å¾—åˆ°æˆ‘ä»¬ Service çš„ IPï¼Œè€Œ port å°±æ˜¯æˆ‘ä»¬åœ¨ yaml æ¡£æŒ‡å®šçš„ portï¼Œåœ¨è¿™è¾¹åˆèµ·æ¥å°±æ˜¯ 10.110.237.205:3001ï¼Œäºæ˜¯æˆ‘ä»¬</p>
<p><code>curl 10.110.237.205:3001</code></p>
<p>å°±å¯ä»¥åœ¨ minikube é‡Œé¢å¾—åˆ°æˆ‘ä»¬çš„å°é²¸é±¼å•°ï¼</p>
<p><strong>Deployment</strong></p>
<p>äº†è§£äº† Service åï¼Œæ¥ä¸‹æ¥è¦æ¥äº†è§£ç¬¬äºŒä¸ªè¿›é˜¶å…ƒä»¶ï¼šDeploymentã€‚ä»Šå¤©å½“æˆ‘ä»¬åŒæ—¶è¦æŠŠä¸€ä¸ªPod åšæ¨ªå‘æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯å¤åˆ¶å¤šä¸ªç›¸åŒçš„Pod åœ¨Cluster ä¸­åŒæ—¶æä¾›æœåŠ¡ï¼Œå¹¶ç›‘æ§å¦‚æœæœ‰Pod å½“æœºæˆ‘ä»¬å°±è¦é‡æ–°æŠŠå®ƒå¯åŠ¨æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¸€ä¸ªPod ä¸€ä¸ªPodé€è¿‡æŒ‡ä»¤å»ºç«‹å¹¶ç›‘æ§æ˜¯å¾ˆèŠ±æ—¶é—´çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€è¿‡ Deployment è¿™ä¸ªç‰¹æ®Šå…ƒä»¶å¸®æˆ‘ä»¬è¾¾æˆä¸Šè¿°çš„è¦æ±‚ã€‚</p>
<p>åŒæ ·è¦å»ºç«‹ä¸€ä¸ª Deploymentï¼Œè¦å…ˆæ’°å†™å±äºä»–çš„èº«åˆ†è¯ã€‚</p>
<p>deployment.yaml</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-deployment
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: demoApp
    spec:
      containers:
        - name: kubernetes-demo-container
          image: hcwxd/kubernetes-demo
          ports:
            - containerPort: 3000
  selector:
    matchLabels:
      app: demoApp
</code></pre>
<p>apiVersion</p>
<ul>
<li>è¯¥å…ƒä»¶çš„ç‰ˆæœ¬å·</li>
</ul>
<p>kind</p>
<ul>
<li>è¯¥å…ƒä»¶æ˜¯ä»€ä¹ˆå±æ€§ï¼Œå¸¸è§æœ‰ Podã€Nodeã€Serviceã€Namespaceã€ReplicationController ç­‰</li>
</ul>
<p>metadata</p>
<ul>
<li>name<br>
æŒ‡å®šè¯¥ Pod çš„åç§°</li>
</ul>
<p>spec</p>
<ul>
<li>
<p>replicas<br>
æŒ‡å®šè¦å»ºç«‹å¤šå°‘ä¸ªç›¸åŒçš„ Podï¼Œåœ¨è¿™è¾¹ç»™çš„æ•°å­—æ˜¯æ‰€è°“çš„ Desire Stateï¼Œå½“ Cluster è¿è¡Œæ—¶å¦‚æœ Pod æ•°é‡ä½äºæ­¤æ•°å­—ï¼ŒKubernetes å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¢åŠ  podï¼Œåä¹‹å°±ä¼šå¸®æˆ‘ä»¬å…³æ‰ Pod</p>
</li>
<li>
<p>template<br>
æŒ‡å®šè¿™ä¸ª Deployment å»ºç«‹çš„ Pod ä»¬ç»Ÿä¸€çš„è®¾å®šï¼ŒåŒ…æ‹¬ metadata ä»¥åŠè¿™äº› Pod çš„ Containersï¼Œè¿™è¾¹æˆ‘ä»¬å°±æ²¿ç”¨ä¹‹å‰å»ºç«‹ Pod çš„è®¾å®š</p>
</li>
<li>
<p>selector<br>
æŒ‡å®šè¿™ä¸ª Deployment çš„è§„åˆ™è¦é€‚ç”¨åˆ°å“ªäº› Podï¼Œåœ¨è¿™è¾¹å°±æ˜¯æŒ‡å®šæˆ‘ä»¬åœ¨ template ä¸­æŒ‡å®šçš„ labels</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€è¿‡æŒ‡ä»¤</p>
<p><code>kubectl create -f deployment.yaml</code></p>
<p>å»ºç«‹å¥½æˆ‘ä»¬çš„ Deploymentï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„ Deployment æœ‰æ²¡æœ‰è¢«å»ºç«‹å¥½</p>
<pre><code class="language-bash">kubectl get deploy
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
my-deployment   3/3     3            3           60s
</code></pre>
<p>æ¥ç€æˆ‘ä»¬åœ¨çœ‹ Pod ä»¬æœ‰æ²¡æœ‰ä¹–ä¹–æŒ‰ç…§ Deployment å»ºç«‹</p>
<pre><code class="language-bash">kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
my-deployment-5454f687cd-bxjfz   1/1     Running   0          60s
my-deployment-5454f687cd-gszbr   1/1     Running   0          60s
my-deployment-5454f687cd-k6zfv   1/1     Running   0          60s
</code></pre>
<p>è¿™è¾¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ª Pod éƒ½è¢«å»ºç«‹å¥½äº†ï¼Œæˆ‘ä»¬å°±æˆåŠŸåšåˆ°äº† Pod çš„æ¨ªå‘æ‰©å±•ã€‚è€Œé™¤äº† Pod çš„æ¨ªå‘æ‰©å±•å¤–ï¼ŒDeployment çš„å¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥å¸®æˆ‘ä»¬åšåˆ°æ— åœæœºçš„ç³»ç»Ÿå‡çº§ï¼ˆZero Downtime Rolloutï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬è¦æ›´æ–°æˆ‘ä»¬çš„ Pod æ—¶ï¼ŒKubernetes å¹¶ä¸ä¼šç›´æ¥ç æ‰æˆ‘ä»¬æ‰€æœ‰çš„ Podï¼Œè€Œæ˜¯ä¼šå»ºç«‹æ–°çš„ Podï¼Œç­‰æ–°çš„ Pod å¼€å§‹æ­£å¸¸è¿è¡Œåï¼Œå†æ¥å–ä»£æ—§çš„ Podã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨æƒ³è¦æ›´æ–°æˆ‘ä»¬ Pod å¯¹å¤–çš„ Portï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€è¿‡æŒ‡ä»¤</p>
<p><code>kubectl edit deployments my-deployment</code></p>
<p>æ¥ç€æˆ‘ä»¬ä¼šçœ‹åˆ°æˆ‘ä»¬çš„ Yaml æ¡£</p>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: '2'
  creationTimestamp: '2019-04-26T04:18:26Z'
  generation: 2
  labels:
    app: demoApp
  name: my-deployment
  namespace: default
  resourceVersion: '328692'
  selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/my-deployment
  uid: 56608fb5-67da-11e9-933f-08002789461f
spec:
  progressDeadlineSeconds: 600
  replicas: 3
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: demoApp
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: demoApp
    spec:
      containers:
        - image: hcwxd/kubernetes-demo
          imagePullPolicy: Always
          name: kubernetes-demo-container
          ports:
            - containerPort: 3000
              protocol: TCP
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
</code></pre>
<p>æˆ‘ä»¬æŠŠå…¶ä¸­ containerPort: 3000 æ”¹æˆ 3001 åå‚¨å­˜ï¼ŒKubernetes å°±ä¼šå¼€å§‹å¸®æˆ‘ä»¬è¿›è¡Œæ›´æ–°ã€‚è¿™æ—¶æˆ‘ä»¬ç»§ç»­ç”¨æŒ‡ä»¤ kubectl get pods å°±ä¼šçœ‹åˆ°</p>
<pre><code class="language-bash">NAME                          READY STATUS            RESTARTS   AGE
my-deployment-5454f687cd-bxjf 1/1   Running           0          60s
my-deployment-5454f687cd-gszb 1/1   Terminating       0          60s
my-deployment-5454f687cd-k6zf 1/1   Running           0          60s
my-deployment-78dc8dcb89-5927 0/1   ContainerCreating 0          1s
my-deployment-78dc8dcb89-dwtl 1/1   Running           0          5s
</code></pre>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼ŒKubernetes ä¼šæ°¸è¿œä¿æŒæœ‰ 3 ä¸ª Pods åœ¨æ­£å¸¸è¿ä½œï¼Œå¦‚æœæœ‰æ–°çš„ Pod è¿˜åœ¨ ContainerCreating çš„é˜¶æ®µæ—¶ï¼Œä»–è¿˜ä¸ä¼šå…³æ‰å¯¹åº”è¦è¢«å–ä»£çš„ Podã€‚è€Œåœ¨è¿‡ä¸€æ®µæ—¶é—´æˆ‘ä»¬è¾“å…¥åŒæ ·æŒ‡ä»¤å¯ä»¥çœ‹åˆ°</p>
<p><code>kubectl rollout history deployment my-deployment</code></p>
<p>çœ‹åˆ°æˆ‘ä»¬ç›®å‰æ›´æ”¹è¿‡çš„ç‰ˆæœ¬</p>
<pre><code class="language-bash">deployment.extensions/my-deployment
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
2         &lt;none&gt;
</code></pre>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬ç›®å‰æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°ç‰ˆæœ¬ 2 çš„ç¨‹å¼æœ‰é—®é¢˜ï¼Œæƒ³è¦å…ˆè®©æœåŠ¡å…ˆæ¢å¤æˆç‰ˆæœ¬ 1 çš„ç¨‹å¼ï¼ˆRollbackï¼‰æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€è¿‡æŒ‡ä»¤</p>
<p><code>kubectl rollout undo deploy my-deployment</code></p>
<p>è®©æˆ‘ä»¬çš„ Pod éƒ½æ¢å¤æˆç‰ˆæœ¬ 1ã€‚ç”šè‡³ä¹‹åå¦‚æœç‰ˆæœ¬å˜çš„è¾ƒå¤šåï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè¦ Rollback åˆ°çš„ç‰ˆæœ¬</p>
<p><code>kubectl rollout undo deploy my-deployment --to-revision=2</code></p>
<p><strong>Ingress</strong><br>
äº†è§£å®Œäº† Service è·Ÿ Deployment å¾Œï¼Œæ¥ä¸‹ä¾†å°±è¼ªåˆ°æ¦‚ã„“å¿µç¨å¾®è¤‡é›œçš„ Ingress å…ƒä»¶äº†ã€‚ åœ¨ä¸Šé¢æœ‰æåˆ° Service å°±æ˜¯ Kubernetes ä¸­ç”¨ä¾†å®šç¾©ã€Œä¸€ç¾¤ Pod è¦å¦‚ä½•è¢«é€£ç·šåŠå­˜å–ã€çš„å…ƒä»¶ã€‚ ä½†åœ¨ Service ä¸­ï¼Œæˆ‘å€‘æ˜¯å°‡æ¯å€‹ Service å…ƒä»¶å°å¤–çš„ port number è·Ÿ Node ä¸Šçš„ port number åš mappingï¼Œé€™æ¨£åœ¨æˆ‘å€‘çš„ Service è®Šå¤šæ™‚ï¼Œport number ä»¥åŠåˆ†æµè¦å‰‡çš„ç®¡ç†è®Šå¾—ç›¸ç•¶å›°é›£ã€‚</p>
<p>è€Œ Ingress å¯ä»¥é€é HTTP/HTTPSï¼Œåœ¨æˆ‘å€‘çœ¾å¤šçš„ Service å‰æ­å»ºä¸€å€‹ reverse-proxyã€‚é€™æ¨£ Ingress å¯ä»¥å¹«åŠ©æˆ‘å€‘çµ±ä¸€ä¸€å€‹å°å¤–çš„ port numberï¼Œä¸¦ä¸”æ ¹æ“š hostname æˆ–æ˜¯ pathname æ±ºå®šå°åŒ…è¦è½‰ç™¼åˆ°å“ªå€‹ Service ä¸Šï¼Œå¦‚åŒä¸‹åœ–çš„æ¯”è¼ƒï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://chriswsq.github.io/post-images/1597919286278.jpg" alt="" loading="lazy"></figure>
<p>åœ¨ Kubernetes ä¸­ï¼ŒIngress è¿™é¡¹æœåŠ¡å…¶å®æ˜¯ç”± Ingress Resourcesã€Ingress Serverã€Ingress Controller æ„æˆã€‚å…¶ä¸­ Ingress Resources å°±æ˜¯å®šä¹‰ Ingress çš„èº«åˆ†è¯ï¼Œè€Œ Ingress Server åˆ™æ˜¯å®ä½“åŒ–ç”¨æ¥æ¥æ”¶ HTTP/HTTPS è¿çº¿çš„ç½‘è·¯ä¼ºæœå™¨ã€‚ä½†å®é™…ä¸Šï¼ŒIngress Server æœ‰å„å¼å„æ ·çš„å®ä½œï¼Œå°±å¦‚åŒå¸‚é¢ä¸Šçš„ Web Server ç³ç…æ»¡ç›®ä¸€æ ·ã€‚å› æ­¤ï¼ŒIngress Controller å°±æ˜¯ä¸€ä¸ªå¯ä»¥æŠŠå®šä¹‰å¥½çš„ Ingress Resources è®¾å®šè½¬æ¢æˆç‰¹å®š Ingress Server å®ä½œçš„è§’è‰²ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼ŒKubernetes ç”±å®˜æ–¹ç»´æŠ¤çš„ä¸¤ç§ Ingress Controller å°±æœ‰ ingress-gce è·Ÿ ingress-nginxï¼Œåˆ†åˆ«å¯ä»¥å¯¹åº”è½¬æ¢æˆ GCE ä¸ Nginxã€‚ä¹Ÿæœ‰å…¶ä»–éå®˜æ–¹åœ¨ç»´æŠ¤çš„ Controllerï¼Œè¯¦ç»†çš„åˆ—è¡¨å¯è§å®˜ç½‘çš„ additional-controllersã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ¥è¯•ç€å»ºç«‹ä¸€ä¸ª Ingress ç‰©ä»¶å»æ ¹æ® hostname è½¬å‘å°åŒ…åˆ°ä¸åŒçš„ Pod ä¸Šé¢ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦ç”¨ Deployment å»ºç«‹å¥½å‡ ä¸ªä¸åŒçš„ Podã€‚åœ¨è¿™è¾¹æˆ‘ä»¬ç›´æ¥é€è¿‡å‡†å¤‡å¥½çš„ä¸¤ä¸ªImage æ¥å»ºç«‹å…¶ä¸­çš„Containerï¼Œblue-whale è¿™ä¸ªImage é‡Œçš„ç¨‹å¼ä¼šç›‘å¬3000 port ç„¶ååœ¨æµè§ˆå™¨ä¸Šè¢«å­˜å–æ—¶ä¼šåå‡ºè“è‰²çš„é²¸é±¼ï¼Œpurple-whale åˆ™ä¼šåå‡ºç´«è‰²çš„é²¸é±¼ã€‚</p>
<p>deployment.yaml</p>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: blue-nginx
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: blue-nginx
    spec:
      containers:
        - name: nginx
          image: hcwxd/blue-whale
          ports:
            - containerPort: 3000
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: purple-nginx
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: purple-nginx
    spec:
      containers:
        - name: nginx
          image: hcwxd/purple-whale
          ports:
            - containerPort: 3000
</code></pre>
<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥é€è¿‡ kubectl create -f deployment.yaml å»ºç«‹å¥½æˆ‘ä»¬çš„ Podã€‚</p>
<pre><code class="language-yaml">AME                            READY   STATUS    RESTARTS  AGE
blue-nginx-6b68c797c7-28tkz    1/1     Running   0         60s
blue-nginx-6b68c797c7-8ww8l    1/1     Running   0         60s
purple-nginx-84854fd7c-8g4nl   1/1     Running   0         60s
purple-nginx-84854fd7c-tmrbs   1/1     Running   0         60s
</code></pre>
<p>å»ºç«‹å¥½äº† Pod ä»¬åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å»ºç«‹è¿™äº› Pod å¯¹å¤–çš„å„è‡ª Serviceï¼Œåœ¨è¿™è¾¹æˆ‘ä»¬ä¼šæŠŠå„è‡³ Container ä¸Šçš„ 3000 port å…¨éƒ¨éƒ½è½¬åˆ° 80 port ä¸Šã€‚</p>
<p>service.yaml</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: blue-service
spec:
  type: NodePort
  selector:
    app: blue-nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: purple-service
spec:
  type: NodePort
  selector:
    app: purple-nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
</code></pre>
<p>é€è¿‡ kubectl create -f service.yaml å»ºç«‹å¥½æˆ‘ä»¬çš„ serviceã€‚</p>
<pre><code class="language-yaml">NAME            TYPE      CLUSTER-IP      EXTERNAL-IP  PORT(S)        
blue-service    NodePort  10.111.192.164  &lt;none&gt;       80:30492/TCP
purple-service  NodePort  0.107.21.77     &lt;none&gt;       80:32086/TCP
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥å»ºç«‹æˆ‘ä»¬çš„ä¸»è§’ Ingress äº†ï¼åœ¨è¿™è¾¹æˆ‘ä»¬çš„Ingress åªæœ‰å¾ˆç®€å•çš„è§„åˆ™ï¼Œä»–ä¼šæŠŠæ‰€æœ‰å‘é€åˆ°blue.demo.com çš„å°åŒ…äº¤ç»™service blue-service è´Ÿè´£ï¼Œè€Œæ ¹æ®ä¸Šé¢service.yaml çš„å®šä¹‰ï¼Œä»–ä¼šå†è½¬äº¤ç»™blue-nginxè¿™ä¸ªPodã€‚è€Œå‘é€ç»™ purple.demo.com åˆ™ä¼šè½¬äº¤ç»™ purple-nginxã€‚<br>
åœ¨è¿™è¾¹ï¼Œæˆ‘ä»¬è¦å…ˆè®°å¾—ä½¿ç”¨æŒ‡ä»¤ minikube addons enable ingress æ¥å¯ç”¨ minikube çš„ ingress åŠŸèƒ½ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°±æ¥æ’°å†™ ingress çš„èº«åˆ†è¯ã€‚</p>
<p>ingress.yaml</p>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: web
spec:
  rules:
    - host: blue.demo.com
      http:
        paths:
          - backend:
              serviceName: blue-service
              servicePort: 80
    - host: purple.demo.com
      http:
        paths:
          - backend:
              serviceName: purple-service
              servicePort: 80
</code></pre>
<p>æˆ‘ä»¬ä¸€æ ·é€è¿‡ kubectl create -f ingress.yaml æ¥å»ºç«‹æˆ‘ä»¬çš„ ingress ç‰©ä»¶ã€‚å¹¶ä½¿ç”¨ kubectl get ingress æ¥æŸ¥çœ‹æˆ‘ä»¬çš„ ingress çŠ¶å†µï¼š</p>
<pre><code class="language-bash">NAME   HOSTS                           ADDRESS     PORTS   AGE
web    blue.demo.com,purple.demo.com   10.0.2.15   80      60s
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ¥æµ‹è¯• ingress æœ‰æ²¡æœ‰ä¹–ä¹–å¸®æˆ‘ä»¬è½¬å‘ã€‚å› ä¸ºæˆ‘ä»¬çš„Cluster å®é™…ä¸Šå¯¹å¤–çš„ip éƒ½æ˜¯æˆ‘ä»¬é€è¿‡æŒ‡ä»¤minikube ip ä¼šçœ‹åˆ°çš„192.168.99.100ï¼Œè¿™æ ·æˆ‘ä»¬è¦æ€ä¹ˆåŒæ—¶è®©è¿™ä¸ªip å¯ä»¥æ˜¯æˆ‘ä»¬è®¾å®šè§„åˆ™ä¸­çš„blue.demo.com ä»¥åŠpurple.demo.comå‘¢ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘ä»¬çŸ¥é“åœ¨ DNS è§£æç½‘å€æ—¶ï¼Œä¼šå…ˆæŸ¥æ‰¾æœ¬æœºä¸Š /etc/hosts åæ‰ä¼šåˆ°å…¶ä»– DNS Server ä¸Šå¯»æ‰¾ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€è¿‡ä¸€ä¸ªå°æŠ€å·§ï¼Œåœ¨æœ¬æœºä¸ŠæŠŠ blue.demo.com ä»¥åŠ purple.demo.com éƒ½æŒ‡å‘ 192.168.99.100ã€‚é€è¿‡æŒ‡ä»¤</p>
<pre><code class="language-bash">echo 192.168.99.100   blue.demo.com  &gt;&gt; /etc/hosts
echo 192.168.99.100   purple.demo.com &gt;&gt; /etc/hosts
</code></pre>
<p>æˆ–æ˜¯é€è¿‡ sudo vim /etc/hosts æ‰‹åŠ¨åŠ ä¸Šè¿™ä¸¤æ¡è§„åˆ™ï¼Œæˆ‘ä»¬å°±æˆåŠŸæå®š DNS å¯ä»¥æ¥æµ‹è¯•äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ blue.demo.com å°±å¯ä»¥å¾—åˆ°ç†Ÿæ‚‰çš„è“è‰²å°é²¸é±¼</p>
<figure data-type="image" tabindex="3"><img src="https://chriswsq.github.io/post-images/1597919547364.png" alt="" loading="lazy"></figure>
<p>ç„¶åè¾“å…¥ purple.demo.com å°±å¯ä»¥å¾—åˆ°ç´«è‰²å°é²¸é±¼å•°ï¼</p>
<figure data-type="image" tabindex="4"><img src="https://chriswsq.github.io/post-images/1597919583300.png" alt="" loading="lazy"></figure>
<p>åœ¨å®é™…å»ºç«‹è¿‡ Podã€Serviceã€Deployment è¿˜æœ‰ Ingress åï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ï¼Œæˆ‘ä»¬è¦æ¥ä»‹ç»ä¸€ä¸ªå¯ä»¥è®©è¿™ä¸ªå»ºç«‹æµç¨‹å˜å¾—æ›´ç®€å•çš„å·¥å…·ï¼Œä¹Ÿå°±æ˜¯ Kubernetes ä¸­çš„ Package Managerï¼šHelmï¼</p>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA-pod">å¦‚ä½•å»ºç«‹ä¸€ä¸ª Pod</a></li>
<li><a href="#%E6%92%B0%E5%86%99-pod-%E7%9A%84%E8%BA%AB%E5%88%86%E8%AF%81">æ’°å†™ Pod çš„èº«åˆ†è¯</a></li>
<li><a href="#%E9%80%8F%E8%BF%87-kubectl-%E5%BB%BA%E7%AB%8B-pod">é€è¿‡ kubectl å»ºç«‹ Pod</a></li>
<li><a href="#%E8%BF%9E%E7%BA%BF%E5%88%B0%E6%88%91%E4%BB%AC-pod-%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B5%84%E6%BA%90">è¿çº¿åˆ°æˆ‘ä»¬ Pod çš„æœåŠ¡èµ„æº</a></li>
<li><a href="#kubernetes-%E8%BF%9B%E9%98%B6%E4%B8%89%E5%85%83%E4%BB%B6">Kubernetes è¿›é˜¶ä¸‰å…ƒä»¶</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">
<div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'nCwKjHbRmhxBO6Dl20UfM5yw-gzGzoHsz',
            appKey: 'DiIo4l1dsGeJ9VKtPoGOjfN5',
			placeholder: 'å” ä¸¤å—é’±å„¿'
        })
    </script>

</div></section>
</div></div></div><script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="æœ¬æ–‡æœ€åæ›´æ–°äº2020-08-20ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";var date1="2020-08-20 18:02:28";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>Copyright Â© 2018-2020 <a href="https://chriswsq.github.io" style="margin:0;">chris&#39;wang</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_uv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>27</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://chriswsq.github.io/media/js/prism.js"></script>
</body>
</html>