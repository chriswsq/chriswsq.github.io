<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>mongodb基础知识与部署 | chris&#39;wang</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://chriswsq.github.io/favicon.ico?v=1610350579720">
<link rel="stylesheet" href="https://chriswsq.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="我们在安装完mongodb之后，默认是没有开启权限认证的， 但是我们在生产环境权限认证是必不可少的
1. 创建用户
启动mongo shell
我们先创建个管理员账号（该账号可以对所有数据库进行用户管理）
root@2613c68bd252..." />
    <meta name="keywords" content="databases" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://chriswsq.github.io">
        <img src="https://chriswsq.github.io/images/avatar.png?v=1610350579720" class="site-logo">
        <h1 class="site-title">chris&#39;wang</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      当你觉得无所事事时，那你就是在虚度光阴
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://chriswsq.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">mongodb基础知识与部署</h2>
            <div class="post-date">2021-01-11</div>
            
            <div class="post-content" v-pre>
              <p>我们在安装完mongodb之后，默认是没有开启权限认证的， 但是我们在生产环境权限认证是必不可少的</p>
<h2 id="1-创建用户">1. 创建用户</h2>
<p>启动mongo shell<br>
我们先创建个管理员账号（该账号可以对所有数据库进行用户管理）</p>
<pre><code class="language-bash">root@2613c68bd252:/# mongo     #进入命令行
MongoDB shell version v4.2.6
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb
Implicit session: session { &quot;id&quot; : UUID(&quot;4b9dd82a-5098-41f1-a265-45bcff0ad0e3&quot;) }
MongoDB server version: 4.2.6
&gt; use admin
switched to db admin
&gt; db.createUser(
... {
...   user: &quot;admin&quot;,
...   pwd: &quot;123456&quot;,
...   roles: [ { role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot;} ]
... }
... )
Successfully added user: {
        &quot;user&quot; : &quot;admin&quot;,
        &quot;roles&quot; : [
                {
                        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,
                        &quot;db&quot; : &quot;admin&quot;
                }
        ]
}
</code></pre>
<h2 id="2-开启权限认证">2. 开启权限认证</h2>
<p>修改conf文件</p>
<pre><code class="language-conf">maxConns = 1000000
fork = false
port = 27017
pidfilepath = /var/run/mongodb_27017.pid
dbpath = /var/lib/mongodb/
logpath = /var/log/mongodb/mongodb.log
logappend = true
bind_ip  = 0.0.0.0
auth = true                         #启动认证模块
journal = true
</code></pre>
<p>重新启动即可<br>
如果是docker-compose启动可docker-entrypoint-initdb.d模块<br>
如下：</p>
<h2 id="docker-compose">docker-compose</h2>
<pre><code class="language-yml">version: &quot;3&quot;
services:
  mongodb:
    image: mongo:4.2.6
    container_name: mongodb
    volumes:
      - /chris/mongodb/init/:/docker-entrypoint-initdb.d/
      - /chris/mongodb/data:/var/lib/mongodb
      - /chris/mongodb/conf/mongod.conf:/etc/mongod.conf
      - /chris/mongodb/logs:/var/log/mongodb
    ports:
      - &quot;27017:27017&quot;
    entrypoint: 'mongod -f /etc/mongod.conf'
    restart: always
</code></pre>
<p><strong>init/init-admin.js</strong></p>
<pre><code class="language-js">db.createUser(
{
    user: &quot;admin&quot;, 
    pwd: &quot;123456&quot;, 
    roles: [
      { role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot;}
    ]
})
</code></pre>
<p><strong>conf/mongod.conf</strong></p>
<pre><code class="language-conf">maxConns = 1000000
fork = false
port = 27017
pidfilepath = /var/run/mongodb_27017.pid
dbpath = /var/lib/mongodb/
logpath = /var/log/mongodb/mongodb.log
logappend = true
bind_ip  = 0.0.0.0
auth = true
journal = true
</code></pre>
<h2 id="3-创建其他的账号">3. 创建其他的账号</h2>
<blockquote>
<p>use admin<br>
switched to db admin<br>
db.auth(&quot;admin&quot;, &quot;123456&quot;)<br>
1<br>
db.createUser(<br>
... {<br>
...  user : &quot;my_tester&quot;,<br>
...  pwd : &quot;123456&quot;,<br>
...  roles: [ { role : &quot;readWrite&quot;, db : &quot;test&quot; }  ]<br>
... }<br>
... )<br>
Successfully added user: {<br>
&quot;user&quot; : &quot;my_tester&quot;,<br>
&quot;roles&quot; : [<br>
{<br>
&quot;role&quot; : &quot;readWrite&quot;,<br>
&quot;db&quot; : &quot;test&quot;<br>
}<br>
]<br>
}</p>
</blockquote>
<h2 id="权限说明基于角色的权限控制">权限说明（基于角色的权限控制）</h2>
<h3 id="数据库用户角色">数据库用户角色</h3>
<p>read: 只读数据权限<br>
readWrite:学些数据权限<br>
<strong>数据库管理角色</strong></p>
<ul>
<li>dbAdmin: 在当前db中执行管理操作的权限</li>
<li>dbOwner: 在当前db中执行任意操作</li>
<li>userADmin: 在当前db中管理user的权限<br>
<strong>备份和还原角色</strong></li>
<li>backup</li>
<li>restore<br>
<strong>夸库角色</strong></li>
<li>readAnyDatabase: 在所有数据库上都有读取数据的权限</li>
<li>readWriteAnyDatabase: 在所有数据库上都有读写数据的权限</li>
<li>userAdminAnyDatabase: 在所有数据库上都有管理user的权限</li>
<li>dbAdminAnyDatabase: 管理所有数据库的权限<br>
<strong>集群管理</strong></li>
<li>clusterAdmin: 管理机器的最高权限</li>
<li>clusterManager: 管理和监控集群的权限</li>
<li>clusterMonitor: 监控集群的权限</li>
<li>hostManager: 管理Server<br>
<strong>超级权限</strong></li>
<li>root: 超级用户</li>
</ul>
<h3 id="52-自定义角色">5.2 自定义角色</h3>
<p>内置角色只能控制User在DB级别上执行的操作，管理员可以创建自定义角色，控制用户在集合级别（Collection-Level）上执行的操作，即，控制User在当前DB的特定集合上执行特定的操作</p>
<p>参考自：https://www.jianshu.com/p/62736bff7e2e</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://chriswsq.github.io/tag/iLCL9rXmm/" class="tag">
                    databases
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://chriswsq.github.io/post/shell-jiao-ben-shu-chu-dai-yan-se-zi-ti/">
                  <h3 class="post-title">
                    shell脚本输出带颜色字体
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>





  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: '',
        owner: '',
        admin: [''],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
