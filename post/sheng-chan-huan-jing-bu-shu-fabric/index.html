<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://chriswsq.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="å½“ä½ è§‰å¾—æ— æ‰€äº‹äº‹æ—¶ï¼Œé‚£ä½ å°±æ˜¯åœ¨è™šåº¦å…‰é˜´"><meta charset="UTF-8"><title>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²fabric | chris&#39;wang</title>
<link href="https://chriswsq.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://chriswsq.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://chriswsq.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<link rel="canonical" href="https://chriswsq.github.io/post/sheng-chan-huan-jing-bu-shu-fabric/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://chriswsq.github.io"><img alt="logo" style="display:inline-block;" src="https://chriswsq.github.io/images/avatar.png"/></a><h1 title="chris&#39;wang" class="weaklink"><a  href="/">chris&#39;wang</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1602668644538" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²fabric</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-08-27</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://chriswsq.github.io/tag/qakyVMdT2/" class="tag">fabric</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">1987å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">11 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<!-- more -->
<h3 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h3>
<ul>
<li>
<p>ansibleä¸´æ—¶æ·»åŠ ä¸»æœºä¿¡æ¯</p>
</li>
<li>
<p>ä¿®æ”¹æœåŠ¡å™¨å¯†ç </p>
</li>
<li>
<p>docker</p>
</li>
<li>
<p>docker-compose</p>
</li>
<li>
<p>æŒ‚è½½æ•°æ®ç›˜</p>
</li>
<li>
<p>ä¼ é€é•œåƒæ–‡ä»¶</p>
</li>
</ul>
<h4 id="ansibleä¸´æ—¶æ·»åŠ ä¸»æœºä¿¡æ¯">ansibleä¸´æ—¶æ·»åŠ ä¸»æœºä¿¡æ¯</h4>
<p>å› ä¸ºåç»­éœ€è¦æ ¹æ®ä¸åŒèŠ‚ç‚¹ä¼ é€’ä¸åŒçš„é•œåƒæ–‡ä»¶ï¼Œæ‰€ä»¥å…ˆä¸´æ—¶æ·»åŠ èŠ‚ç‚¹ä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼šé¾™å²©èŠ‚ç‚¹   fz</p>
<pre><code class="language-bash">[fz]
z1      ansible_host=121.204.20.15
z2      ansible_host=121.204.220.15
z3      ansible_host=121.204.20.14
z4      ansible_host=121.204.20.15
z5      ansible_host=121.204.20.11
z6      ansible_host=121.204.20.1
z7      ansible_host=121.204.22.14
z8      ansible_host=121.204.20.14
z9      ansible_host=121.204.20.14
z10     ansible_host=121.204.220.1
                     
[fz:vars]
ansible_ssh_port=650
ansible_ssh_pass='123456'
</code></pre>
<h4 id="ä¿®æ”¹æœåŠ¡å™¨å¯†ç ">ä¿®æ”¹æœåŠ¡å™¨å¯†ç </h4>
<p>/application/ansible-playbook/optimization/</p>
<pre><code class="language-bash">#æ¨é€ansibleæœåŠ¡å™¨ç§˜é’¥
ansible-playbook -e host=fz  push-ssh.yaml
#æ›´æ”¹æœåŠ¡å™¨å¯†ç 
ansible-playbook -e host=fz  changepw.yaml

</code></pre>
<h4 id="å®‰è£…docker">å®‰è£…docker</h4>
<p>playbook åœ°å€ï¼š<br>
/application/ansible-playbook/optimization</p>
<p><code>ansible-playbook -e host=fz install-docker.yaml</code></p>
<p><strong>å®‰è£…docker</strong></p>
<pre><code class="language-bash">#å®‰è£…ä¾èµ–
ansible     fz  -m shell -a    &quot;yum install -y yum-utils ;yum-config-manager --add-repo   https://download.docker.com/linux/centos/docker-ce.repo&quot;

#ä»ansibleä¸»æœºä¼ é€ docker-ce-18.03.1.ce-1.el7.centos.x86_64.rpm æ–‡ä»¶

ansible fz  -m copy -a &quot;src=/home/ansible-playbook/optimization/common/docker-ce-18.03.1.ce-1.el7.centos.x86_64.rpm dest=/root/&quot;

# å®‰è£…
ansible fz  -m  shell  -a &quot;yum  -y install docker-ce-18.03.1.ce-1.el7.centos.x86_64.rpm&quot;
</code></pre>
<p><strong>æ‹·è´daemon.jsonæ–‡ä»¶</strong></p>
<pre><code class="language-bash">
ansible fz  -m shell -a &quot;mkdir /etc/docker&quot;

ansible fz  -m copy -a &quot;src=/application/ansible-playbook/localnode/fabirc/peer/install-peer/template/daemon.json dest=/etc/docker/&quot;
</code></pre>
<h4 id="å®‰è£…docker-compose">å®‰è£…docker-compose</h4>
<p>å¯åœ¨ä¼ é€é•œåƒæ˜¯å®‰è£…ä¹Ÿå¯æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…</p>
<pre><code class="language-bash">curl -L https://get.daocloud.io/docker/compose/releases/download/1.12.0/docker-compose-`uname -s`-`uname -m` &gt; ./docker-compose
mv ./docker-compose /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
docker-compose -v
æˆ–
ansible fz  -m copy -a &quot;src=/application/ansible-playbook/common/iso/docker-compose dest=/usr/bin/docker-compose mode=0755&quot;
</code></pre>
<blockquote>
<p>æ³¨ï¼š å¦‚æœæ˜¯æ‰‹åŠ¨å®‰è£…docker éœ€è¦è°ƒæ•´dockerçš„æ•°æ®ç›®å½•<br>
/usr/lib/systemd/system/docker.service</p>
</blockquote>
<h4 id="æŒ‚è½½æ•°æ®ç›˜">æŒ‚è½½æ•°æ®ç›˜</h4>
<pre><code class="language-bash">#æŸ¥çœ‹æ•°æ®ç›˜
fdisk -l
#ç£ç›˜åˆ†åŒº
fdisk /dev/vdb
n
p
å›è½¦
å›è½¦
å›è½¦
w
#æ ¼å¼åŒ–ç£ç›˜
mkfs.xfs -n ftype=1 /dev/vdb1
#æ·»åŠ æ°¸ä¹…æŒ‚è½½
echo '/dev/vdb1                                 /bsn                    xfs     defaults        0 0' &gt;&gt;/etc/fstab
#åˆ›å»ºæŒ‚åœ¨ç›®å½•
mkdir /bsn
#åˆå§‹åŒ–æŒ‚è½½
mount -a
#æŸ¥çœ‹æŒ‚åœ¨æƒ…å†µ
df -hT

</code></pre>
<h4 id="ä¼ é€é•œåƒæ–‡ä»¶">ä¼ é€é•œåƒæ–‡ä»¶</h4>
<p>æ ¹æ®èŠ‚ç‚¹ä¸åŒçš„æœåŠ¡ç±»å‹æ¥ä¼ é€ä¸åŒçš„é•œåƒ</p>
<p><strong>ä¼ é€æœåŠ¡èŠ‚ç‚¹çš„é•œåƒ</strong></p>
<p>ä½¿ç”¨ansibleæœåŠ¡å™¨ä¸Š  /application/ansible-playbook/optimization/copy.yaml æ–‡ä»¶è¿›è¡Œä¼ é€</p>
<pre><code class="language-bash">- hosts: &quot;{{ host }}&quot;
  remote_user: root
  tasks:
    #- name: å®‰è£…zip
    #  yum: name=unzip state=latest
    - name: åˆ›å»ºé•œåƒç›®å½•/bsn/iso
      file:
        path: /bsn/iso
        state: directory
        mode: '0755'
    - name: ä¼ é•œåƒ
      copy:
        src: /application/ansible-playbook/common/iso/{{ item }}
        dest: /bsn/iso
      with_items:
       # - bsnCa-tomcat9.zip
       # - zipkin.zip
        - docker-compose
        - fabric-peer1.4.3.1.zip
        - fabric-tools1.4.3.1.zip
        - fabric-couchdb.zip
        - fabric-ccenv.zip
        - docker-ce-18.03.1.ce-1.el7.centos.x86_64.rpm
        - fabric-ca-postgresql.zip
        - fabric-ca-service.zip
        - webase-mysql.zip     
        - fabric-gateway.zip   
        - fisco-gm-0.3.zip    
        - webase-mysql.zip
        - webasechainmanager.zip
        - webasesign.zip       
        - gateway-service-v4.zip               
        - zipkin.zip
        - mcs.zip
    - name: è§£å‹
      shell: cd /bsn/iso &amp;&amp; unzip \*.zip
      ignore_errors: yes
</code></pre>
<pre><code class="language-bash">#æ ¹æ®èŠ‚ç‚¹æ‰€éœ€é•œåƒè¿›è¡Œä¼ é€ï¼Œå¯å…ˆå°†ä¸éœ€è¦çš„æ³¨é‡Šæ‰

peerèŠ‚ç‚¹
        - fabric-peer1.4.3.1.zip
        - fabric-tools1.4.3.1.zip
        - fabric-couchdb.zip
        - fabric-ccenv.zip
        
caèŠ‚ç‚¹		
        - fabric-ca-postgresql.zip
        - fabric-ca-service.zip
        - webase-mysql.zip 
        
ç½‘å…³èŠ‚ç‚¹		
        - fabric-gateway.zip  
        - rabbitmq.zip
        - consul.zip
        
fiscoèŠ‚ç‚¹		
        - fisco-gm-0.3.zip
        
fiscoç­¾åæœåŠ¡ é“¾ç®¡ç†
        - webase-mysql.zip
        - webasechainmanager.zip
        - webasesign.zip
        
å¾®æœåŠ¡èŠ‚ç‚¹		
        - zipkin.zip
        - mcs.zip
 
</code></pre>
<p><strong>peerèŠ‚ç‚¹ ï¼ˆz1  z2  z3ï¼‰</strong></p>
<pre><code class="language-bash">ansible-playbook -e host=fz copy.yaml -l z1,z2,z3   #ä¿ç•™copy.yamlæ–‡ä»¶ä¸­å››ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ³¨é‡Š
</code></pre>
<p><strong>caèŠ‚ç‚¹ï¼ˆz6ï¼‰</strong></p>
<pre><code class="language-bash">ansible-playbook -e host=fz copy.yaml -l z6   #ä¿ç•™copy.yamlæ–‡ä»¶ä¸­ä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ³¨é‡Š
</code></pre>
<p><strong>ç½‘å…³èŠ‚ç‚¹ï¼ˆz4ï¼‰</strong></p>
<pre><code class="language-bash">ansible-playbook -e host=fz copy.yaml -l z4   #ä¿ç•™copy.yamlæ–‡ä»¶ä¸­ä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä»–æ³¨é‡Š
</code></pre>
<blockquote>
<p>æ³¨ï¼š å› é•œåƒæ–‡ä»¶è¾ƒå¤§ï¼Œä¼ é€æ—¶é—´è¾ƒé•¿ï¼Œéœ€è€å¿ƒç­‰å€™</p>
<p>ä¼ é€é•œåƒæœåŠ¡ç»“æŸä¹‹åå°†ä¸´æ—¶åˆ›å»ºçš„å˜é‡æ–‡ä»¶ç§»é™¤æ‰ï¼ˆä¸€èˆ¬ç§»é™¤è‡³/mnt ä¸‹ï¼‰</p>
</blockquote>
<h3 id="éƒ¨ç½²peeræœåŠ¡">éƒ¨ç½²peeræœåŠ¡</h3>
<h4 id="ä¿®æ”¹peerå˜é‡æ–‡ä»¶">ä¿®æ”¹peerå˜é‡æ–‡ä»¶</h4>
<p>/etc/ansible/inventory/peer1   peer2   peer3</p>
<p>ä¸¤ä¸ªæ–¹é¢è°ƒæ•´ï¼Œæ·»åŠ ä¸»æœºç»„ã€ä¸»æœºç»„æ·»åŠ è‡³å­ç»„ï¼ˆä¾‹å¦‚ï¼špeer1ï¼‰</p>
<pre><code class="language-bash">#æ·»åŠ ä¸»æœºç»„
[fuzhou_peer1]
fuzhou_peer1 ansible_host=121.204.220.16 ansible_ssh_port=22

[fuzhou_peer1:vars]
peer=peer1
name=fuzhou
MSP=Fuzhou
node1=172.31.0.3
node2=172.31.0.1
node3=172.31.0.2
cjq=172.31.0.2

#æ·»åŠ å­ç»„
[peer1:children]
suzhou_peer1


</code></pre>
<h4 id="ä¸Šä¼ peerç›¸å…³æ–‡ä»¶">ä¸Šä¼ peerç›¸å…³æ–‡ä»¶</h4>
<p>fuzhou-peer1.zip  fuzhou-peer2.zip  fuzhou-peer3.zip</p>
<p>ä¸Šä¼ è‡³<br>
/application/ansible-playbook/localnode/fabirc/peer/install-peer/peer-package</p>
<h4 id="éƒ¨ç½²peer1-2-3">éƒ¨ç½²peer1 2 3</h4>
<p>æ‰§è¡Œç›®å½•ï¼š/application/ansible-playbook/localnode/fabirc/peer/install-peer</p>
<pre><code class="language-bash">ansible-playbook -e host=peer1 install-peer1.yaml -l fuzhou_peer1
ansible-playbook -e host=peer2 install-peer2.yaml -l fuzhou_peer2
ansible-playbook -e host=peer3 install-peer3.yaml -l fuzhou_peer3
</code></pre>
<blockquote>
<p>æŸ¥çœ‹é“¾ç è¿™å—ä¼šæŠ¥é”™ï¼Œå¿½ç•¥å³å¯</p>
</blockquote>
<h3 id="éƒ¨ç½²caæœåŠ¡">éƒ¨ç½²caæœåŠ¡</h3>
<h4 id="ä¿®æ”¹caå˜é‡æ–‡ä»¶">ä¿®æ”¹caå˜é‡æ–‡ä»¶</h4>
<p>/etc/ansible/inventory/ca</p>
<p>ä¸¤ä¸ªæ–¹é¢è°ƒæ•´ï¼Œæ·»åŠ ä¸»æœºç»„ã€ä¸»æœºç»„æ·»åŠ è‡³å­ç»„</p>
<pre><code class="language-bash">#æ·»åŠ ç¾¤ç»„
[fuzhou_ca]
fuzhou_ca ansible_host=121.204.220.14  ansible_ssh_port=22 name=fuzhou

#æ·»åŠ å­ç»„
[ca:children]
fuzhou_ca

</code></pre>
<blockquote>
<p>åŠ å…¥é“¾ç éƒ¨åˆ†ä¼šæŠ¥é”™ï¼Œå¾…é‡‡é›†å™¨éƒ¨ç½²å®Œåä¹‹åæ‰‹åŠ¨åŠ å…¥é“¾ç å¹¶å®‰è£…ï¼ˆå‘½ä»¤å¯è§playbookæ–‡ä»¶åº•éƒ¨ï¼‰</p>
</blockquote>
<h4 id="ä¸Šä¼ caç›¸å…³æ–‡ä»¶">ä¸Šä¼ caç›¸å…³æ–‡ä»¶</h4>
<p>fuzhou-ca.zip</p>
<p>ä¸Šä¼ è‡³<br>
/application/ansible-playbook/localnode/fabirc/ca/install-ca/ca-package</p>
<h4 id="éƒ¨ç½²ca-mysql">éƒ¨ç½²ca-mysql</h4>
<p>æ‰§è¡Œç›®å½• /application/ansible-playbook/localnode/fabirc/ca/install-mysql</p>
<pre><code class="language-bash">ansible-playbook -e host=ca install-mysql.yaml -l fuzhou_ca
</code></pre>
<h4 id="éƒ¨ç½²ca-service">éƒ¨ç½²ca-service</h4>
<p>æ‰§è¡Œç›®å½• ï¼š/application/ansible-playbook/localnode/fabirc/ca/install-ca</p>
<pre><code class="language-bash">ansible-playbook -e host=ca install-ca.yaml -l fuzhou_ca
</code></pre>
<h4 id="æ£€æŸ¥çŠ¶æ€">æ£€æŸ¥çŠ¶æ€</h4>
<p>æŸ¥çœ‹æ•°æ®åº“è¡¨çŠ¶æ€</p>
<pre><code class="language-bash">  docker exec cjq-gate-mysql  mysql -uroot -pRed80@80 -e &quot;use bsnflowdb;select * from tb_nc_config&quot;
</code></pre>
<h3 id="éƒ¨ç½²gatewayæœåŠ¡">éƒ¨ç½²gatewayæœåŠ¡</h3>
<h4 id="ä¿®æ”¹caå˜é‡æ–‡ä»¶-2">ä¿®æ”¹caå˜é‡æ–‡ä»¶</h4>
<p>/etc/ansible/inventory/gateway_M</p>
<p>ä¸¤ä¸ªæ–¹é¢è°ƒæ•´ï¼Œæ·»åŠ ä¸»æœºç»„ã€ä¸»æœºç»„æ·»åŠ è‡³å­ç»„</p>
<pre><code class="language-bash">#æ·»åŠ ä¸»æœºç»„
[fuzhou_gateway_M]
fuzhou_gateway_M ansible_host=121.204.220.10  ansible_ssh_port=22

[fuzhou_gateway_M:vars]
name=fuzhou
MSP=Fuzhou
titleName=ç¦å·
code=ORG20200804                   #æ ¹æ®å½“å¤©æ—¥å¿—å¡«å†™å³å¯
node1=172.31.0.31                  #ä¸‰ä¸ªpeerèŠ‚ç‚¹çš„å†…ç½‘åœ°å€
node2=172.31.0.23
node3=172.31.0.26
sign=1.1.1.1                        #æ²¡æœ‰fisco å¡«å†™1.1.1.1
ca=172.31.0.24                      
mcs=1.1.1.1                         #æ²¡æœ‰å¾®æœåŠ¡ å¡«å†™1.1.1.1

#æ·»åŠ å­ç»„
[gateway_M:children]
nanping_gateway_M

</code></pre>
<h4 id="ä¸Šä¼ gatewayç›¸å…³æ–‡ä»¶">ä¸Šä¼ gatewayç›¸å…³æ–‡ä»¶</h4>
<p>fuzhou-certs.zip</p>
<p>ä¸Šä¼ è‡³<br>
/application/ansible-playbook/localnode/fabirc/gateway/install-gate/gateway-certs</p>
<h4 id="éƒ¨ç½²gateway">éƒ¨ç½²gateway</h4>
<p>æ‰§è¡Œç›®å½•ï¼š/application/ansible-playbook/localnode/fabirc/gateway/install-gate</p>
<pre><code class="language-bash">ansible-playbook -e host=gateway_M install-gate.yaml -l fuzhou_gateway_M
</code></pre>
<h3 id="éƒ¨ç½²é‡‡é›†å™¨æœåŠ¡">éƒ¨ç½²é‡‡é›†å™¨æœåŠ¡</h3>
<h4 id="ä¿®æ”¹cjqå˜é‡æ–‡ä»¶">ä¿®æ”¹cjqå˜é‡æ–‡ä»¶</h4>
<pre><code class="language-bash">[fuzhou_cjq]
fuzhou_cjq ansible_host=121.204.220.18 ansible_ssh_port=22

[fuzhou_cjq:vars]
name=fuzhou
MSP=Fuzhou
titleName=ç¦å·
code=ORG20200804
node1=172.31.0.31
node2=172.31.0.23
node3=172.31.0.26
ca=172.31.0.24
peerport=22
fiscocron=false          #æ²¡æœ‰fiscoåˆ™å¡«å†™false
fiscosign=1.1.1.1        #æ²¡æœ‰fiscoåˆ™å¡«å†™ 1.1.1.1
xupercron=false          #æ²¡æœ‰xupercronåˆ™å¡«å†™false    
mcs=1.1.1.1              #æ²¡æœ‰å¾®æœåŠ¡åˆ™å¡«å†™1.1.1.1
gmfabriccron=false       #æ²¡æœ‰å¾®æœåŠ¡åˆ™å¡«å†™false
</code></pre>
<h4 id="ä¸Šä¼ é‡‡é›†å™¨ç›¸å…³æ–‡ä»¶">ä¸Šä¼ é‡‡é›†å™¨ç›¸å…³æ–‡ä»¶</h4>
<p>fuzhou-collect.zip</p>
<p>ä¸Šä¼ è‡³<br>
/application/ansible-playbook/localnode/fabirc/cjq/install-cjq/install-package</p>
<h4 id="éƒ¨ç½²cjq">éƒ¨ç½²CJQ</h4>
<p>æ‰§è¡Œç›®å½•ï¼š/application/ansible-playbook/localnode/fabirc/cjq/install-cjq</p>
<pre><code class="language-bash">ansible-playbook -e host=cjq install-cjq.yaml -l fuzhou_cjq
</code></pre>
<h4 id="æŸ¥çœ‹æœåŠ¡æ—¥å¿—">æŸ¥çœ‹æœåŠ¡æ—¥å¿—</h4>
<p>/bsn/go/src/node-collect/logs</p>
<pre><code class="language-bash">tail -100f /bsn/go/src/node-collect/logs/catalina.out
</code></pre>
<p>å¦‚æœå‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼Œåˆ™éœ€è¦é‡æ–°åŠ å…¥é“¾ï¼Œå®‰è£…é“¾</p>
<pre><code class="language-bash">2020-08-04 13:57:55.381 ERROR 4179 --- [ost-startStop-1] c.b.n.u.C.BaseConfigUtils$Companion      : /bsn/go/src/node-collect/webapps/nodecollectConf/conf/xuperChainBlockResult.properties (No such file or directory)
2020-08-04 13:57:55.487  INFO 4179 --- [ost-startStop-1] c.b.n.utils.NetUtils$Companion           : è¯·æ±‚åœ°å€ï¼šhttp://1.1.1.1:5005/WeBASE-Chain-Manager/chain/all
2020-08-04 14:00:02.770  INFO 4179 --- [ost-startStop-1] c.b.n.utils.NetUtils$Companion           : å¤„ç†å¼‚å¸¸ï¼šConnection timed out (Connection timed out),é™„åŠ ä¿¡æ¯ï¼šfiscoè·å–æ‰€æœ‰é“¾ç¼–å·
2020-08-04 14:00:02.794 ERROR 4179 --- [ost-startStop-1] c.b.n.u.C.BaseConfigUtils$Companion      : /bsn/go/src/node-collect/webapps/nodecollectConf/conf/sm2FabricBlockResult.properties (No such file or directory)
2020-08-04 14:00:02.830  INFO 4179 --- [ost-startStop-1] c.b.nodecollector.task.FiscoTimeTask     : fisco fbTimetaskopenorclose==false
2020-08-04 14:00:02.831  INFO 4179 --- [ost-startStop-1] c.b.nodecollector.task.FiscoTimeTask     : fisco channelsUploadTime==1200000
2020-08-04 14:00:02.831  INFO 4179 --- [ost-startStop-1] c.b.nodecollector.task.FiscoTimeTask     : fisco blocksUploadTime==1200000
2020-08-04 14:00:02.831  INFO 4179 --- [ost-startStop-1] c.b.nodecollector.task.FiscoTimeTask     : fisco peerResourceUploadTime==600000
</code></pre>
<p>åœ¨peerçš„3ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</p>
<pre><code class="language-bash">#åŠ å…¥é“¾ç 
docker exec cli peer channel join -b blocktx/netchannel.block

#å®‰è£…é“¾ç 
docker exec cli peer chaincode install blocktx/cc_sys.3.0.pak 

</code></pre>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">ç¯å¢ƒå‡†å¤‡</a>
<ul>
<li><a href="#ansible%E4%B8%B4%E6%97%B6%E6%B7%BB%E5%8A%A0%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF">ansibleä¸´æ—¶æ·»åŠ ä¸»æœºä¿¡æ¯</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%86%E7%A0%81">ä¿®æ”¹æœåŠ¡å™¨å¯†ç </a></li>
<li><a href="#%E5%AE%89%E8%A3%85docker">å®‰è£…docker</a></li>
<li><a href="#%E5%AE%89%E8%A3%85docker-compose">å®‰è£…docker-compose</a></li>
<li><a href="#%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98">æŒ‚è½½æ•°æ®ç›˜</a></li>
<li><a href="#%E4%BC%A0%E9%80%81%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6">ä¼ é€é•œåƒæ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2peer%E6%9C%8D%E5%8A%A1">éƒ¨ç½²peeræœåŠ¡</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9peer%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6">ä¿®æ”¹peerå˜é‡æ–‡ä»¶</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0peer%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6">ä¸Šä¼ peerç›¸å…³æ–‡ä»¶</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2peer1-2-3">éƒ¨ç½²peer1 2 3</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2ca%E6%9C%8D%E5%8A%A1">éƒ¨ç½²caæœåŠ¡</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9ca%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6">ä¿®æ”¹caå˜é‡æ–‡ä»¶</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0ca%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6">ä¸Šä¼ caç›¸å…³æ–‡ä»¶</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2ca-mysql">éƒ¨ç½²ca-mysql</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2ca-service">éƒ¨ç½²ca-service</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E7%8A%B6%E6%80%81">æ£€æŸ¥çŠ¶æ€</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2gateway%E6%9C%8D%E5%8A%A1">éƒ¨ç½²gatewayæœåŠ¡</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9ca%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6-2">ä¿®æ”¹caå˜é‡æ–‡ä»¶</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0gateway%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6">ä¸Šä¼ gatewayç›¸å…³æ–‡ä»¶</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2gateway">éƒ¨ç½²gateway</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2%E9%87%87%E9%9B%86%E5%99%A8%E6%9C%8D%E5%8A%A1">éƒ¨ç½²é‡‡é›†å™¨æœåŠ¡</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9cjq%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6">ä¿®æ”¹cjqå˜é‡æ–‡ä»¶</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E9%87%87%E9%9B%86%E5%99%A8%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6">ä¸Šä¼ é‡‡é›†å™¨ç›¸å…³æ–‡ä»¶</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2cjq">éƒ¨ç½²CJQ</a></li>
<li><a href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97">æŸ¥çœ‹æœåŠ¡æ—¥å¿—</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">
<div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'nCwKjHbRmhxBO6Dl20UfM5yw-gzGzoHsz',
            appKey: 'DiIo4l1dsGeJ9VKtPoGOjfN5',
			placeholder: 'å” ä¸¤å—é’±å„¿'
        })
    </script>

</div></section>
</div></div></div><script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="æœ¬æ–‡æœ€åæ›´æ–°äº2020-08-27ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";var date1="2020-08-27 13:40:46";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>Copyright Â© 2018-2020 <a href="https://chriswsq.github.io" style="margin:0;">chris&#39;wang</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_uv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>27</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://chriswsq.github.io/media/js/prism.js"></script>
</body>
</html>